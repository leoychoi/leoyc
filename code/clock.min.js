let clock=new p5((e=>{Date.prototype.addSeconds=function(e){const t=new Date(this);return t.setSeconds(t.getSeconds()+e),t};var t,n=[],s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=1,a=new Date;let r,l;e.setup=()=>{r=e.windowWidth/1.75,l=.6*e.windowHeight,e.createCanvas(r,l),u(),o=1,S(),t=l-1.5*o,i(),e.frameRate(20)},e.windowResized=()=>{r=e.windowWidth/1.75,l=.6*e.windowHeight,e.resizeCanvas(r,l),o=1,S()},e.draw=()=>{if(e.background(230),a=new Date,u(),S(),t=l-1.5*o,i(),!(e.mouseX>0&&e.mouseX<r&&e.mouseY>0&&e.mouseY<l))return;g();let n=f(),s=w();x(s,171,n,255,247,102,"solstice",0),x(s,79,n,137,214,0,"equinox",0),x(s,355,n,33,0,123,"solstice",0),x(s,266,n,186,76,0,"equinox",0);let c=SunCalc.getTimes(a,40.7,-74);const[d,h]=M(c);let E=24*a.getDate();x(E,24*d.getDate(),24*D(a.getMonth()+1),0,4,109,"new moon",1),x(E,24*h.getDate(),24*D(a.getMonth()+1),250,249,249,"full moon",1);let H=60*a.getHours()+a.getMinutes();x(H,60*c.sunrise.getHours()+c.sunrise.getMinutes(),1440,255,231,171,"sunrise",2),x(H,60*c.sunsetStart.getHours()+c.sunsetStart.getMinutes(),1440,209,202,252,"sunset",2)};const u=()=>{n=[a.getFullYear(),a.getMonth()+1,a.getDate(),a.getHours(),a.getMinutes()]},i=()=>{for(let t=1;t<5;t++)e.line(t*(r/5),0,t*(r/5),l);e.fill(0),e.rect(0,t+.62*o,r,.05*o),e.textAlign(e.CENTER,e.BASELINE),e.text(",",r-2*r/5,t+o),e.text(":",r-r/5,t+o)},g=()=>{e.textSize(o);for(let s=0;s<5;s++){next=new Date(a.getTime()),progress=c(s);let r=progress*t+progress*o;switch(e.textAlign(e.CENTER,e.BASELINE),e.fill(125),s){case 0:next.setFullYear(next.getFullYear()+1),d(s,next.getFullYear(),r,!0);break;case 1:next.setMonth(next.getMonth()+1),next.getMonth()+1>12?d(s,1,r,!0):d(s,next.getMonth()+1,r,!0);break;case 2:next.setDate(next.getDate()+1),d(s,next.getDate(),r,!0);break;case 3:next.setHours(next.getHours()+1),d(s,next.getHours(),r,!0);break;case 4:next.setMinutes(next.getMinutes()+1),next.getMinutes()<10?d(s,"0"+next.getMinutes(),r,!0):d(s,next.getMinutes(),r,!0)}if(e.textAlign(e.CENTER,e.BASELINE),e.fill(0),r>t+.25*o){let e=n[s];(4==s&&n[s]<10||3==s&&0==n[s])&&(e="0"+e),d(s,e,t+.75*o+(r-t),!1)}else 4==s&&n[s]<10||3==s&&0==n[s]?d(s,"0"+n[s],t+o,!1):d(s,n[s],t+o,!1)}},c=e=>{switch(e){case 0:return w()/f();case 1:return(a.getHours()+24*(a.getDate()-1))/(24*D(a.getMonth()));case 2:return(60*a.getHours()+a.getMinutes())/1440;case 3:return(60*a.getMinutes()+a.getSeconds())/3600;case 4:return(1e3*a.getSeconds()+a.getMilliseconds())/6e4}},d=(t,n,a,l)=>{l&&e.rect(t*(r/5),a-.38*o,r/5,.05*o),e.stroke(10),e.text(1===t?s[n-1]:n,t*(r/5)+r/5/2,a)},x=(n,s,a,l,u,i,g,c,d=.1)=>{let x=0;n<s?x=1-(s-n)/a:(x=1-(a-n+s)/a,x=0==x?1:x);let M=(t+.6*o)*x;e.fill(l,u,i),e.rect(c*r/5,M,r/5,o*d),e.textSize(20),e.textAlign(e.LEFT,e.BOTTOM),e.text(g,c*r/5,M),e.textSize(o)},M=()=>{let e=0,t=0;for(let n=1;n<=30;n++){const s=SunCalc.getMoonIllumination(a.addSeconds(86400*e)),o=SunCalc.getMoonIllumination(a.addSeconds(86400*t)),r=SunCalc.getMoonIllumination(a.addSeconds(86400*n));r.fraction<s.fraction&&(e=n),r.fraction>o.fraction&&(t=n)}return[new Date(a.addSeconds(86400*e).setHours(0,0,0,0)),new Date(a.addSeconds(86400*t).setHours(0,0,0,0))]},S=()=>{let t=a.getFullYear(),n=r/5-20;for(;e.textWidth(t)<n;)o+=1,e.textSize(o)},w=()=>{let e=new Date(a.getFullYear(),0,0),t=a-e;return Math.floor(t/864e5)},D=e=>(e+=1,new Date(a.getFullYear(),e,0).getDate()),f=()=>(new Date).getFullYear()%4==0?366:365}),"clockSketch");